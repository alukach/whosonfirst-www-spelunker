{% extends "base.html" %}
{% block title %}{{ doc.properties.get("wof:id") |e }} | {{ doc.properties.get("wof:name") |e }}{% endblock %}
{% block content %}

<div class="row">
<h2>{{ doc.properties.get("wof:name") |e }} <small>{{doc.properties.get("wof:path") |e }}</small></h2>
</div>

<div class="row">
<div class="col-md-12" id="map"></div>
</div>

<div class="row">
<small>{{ doc.properties.get("wof:name") | e }} is a <span class="hey-look">{{ doc.properties.get("wof:placetype") | e }}</span> and its consensus geometry is from <a href="/search/?q={{ doc.properties.get('src:geom', 'unknown') | e}}" class="hey-look">{{ doc.properties.get('src:geom', 'unknown') | e}}</a>.
{% if doc.properties.get("src:lbl:centroid") %}Its <span class="hey-look">label centroid</span> is derived from <a href="/search/?q={{ doc.properties.get('src:lbl:centroid', 'unknown') | e}}" class="hey-look">{{ doc.properties.get('src:lbl:centroid', 'unknown') | e}}</a>.{% elif doc.properties.get("src:centroid_lbl") %}Its <span class="hey-look">label centroid</span> is derived from <a href="/search/?q={{ doc.properties.get('src:centroid_lbl', 'unknown') | e}}" class="hey-look">{{ doc.properties.get('src:centroid_lbl', 'unknown') | e}}</a> ... and it looks like the label centroid needs to be reprocessed.{% else %}OH NOES!!! MISSING <span class="hey-look">LABEL CENTROID</span>{% endif %}</small>
</div>

<div class="row debug">

<div class="col-md-7 debug">

<h3>Properties</h3>
<pre id="props">{{ doc['properties'] |pprint|e }}</pre>

<h3>Bounding box</h3>
<pre>{{ doc['bbox'] |pprint|e }}</pre>

</div>

<div class="col-md-5 debug">

<h3>Hierarchy</h3>

{% for hierarchy in hierarchies %}
<ul>
{% for w in hierarchy %}
{% if hierarchy[ w ] %}
<li>the {{ w|e }} of <a href="/id/{{ hierarchy[ w ]['properties']['wof:id'] | e }}/">{{ hierarchy[ w ]['properties']['wof:name'] | e }}</a></li>
{% else %}
<li>a <code>{{ w | escape }}</code> that we aren't able to index correctly because... ?</li>
{% endif %}
{% endfor %}
</ul>
{% endfor %}

<h4>Other</h4>
<ul>
<li><a href="/id/{{ doc.properties.get("wof:id") |e }}/descendants/">See all the descendants of {{ doc.properties.get("wof:name") | e }}</a></li>

<li><a href="/reverse/?latitude={{ doc.properties.get("geom:latitude") |e }}&longitude={{ doc.properties.get("geom:longitude") |e }}" target="_reversegeo">Reverse geocode</a> ({{ doc.properties.get("geom:latitude") |e }}, {{ doc.properties.get("geom:longitude") |e }})</li>

<li><a href="http://whosonfirst.mapzen.com/data/{{ doc.properties.get("wof:path") |e }}" target="data">Raw data (GeoJSON)</a></li>

</ul>

</div>
</div>

<script type="text/javascript">

window.onload = function(e){

	mapzen.whosonfirst.spelunker.toggle_data_endpoint("{{ doc.properties.get("wof:placetype") |e }}");

	var map = mapzen.whosonfirst.leaflet.tangram.map_with_bbox('map', {{ doc.bbox.1|e }},{{ doc.bbox.0|e }}, {{ doc.bbox.3|e }}, {{ doc.bbox.2|e }});

	mapzen.whosonfirst.enmapify.render_id(map, {{ doc.properties.get("wof:id") |e }});
        return;
};

</script>
{% endblock %}
